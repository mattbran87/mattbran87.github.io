# Notes: Custom Theme

## Research & Planning

### Findings

#### Jekyll SME

- **Override priority:** Project `_layouts/` files take precedence over gem theme layouts unconditionally. Jekyll reads project layouts first (`=`), then theme layouts with `||=` (no-op if key exists). Same for includes via `includes_load_paths`.
- **Removing `theme: minima`:** Sets `site.theme` to nil. All theme layout/include/sass paths stop being searched. Any missing layout produces a build warning; any missing include aborts the build.
- **Full Minima removal is safe** once all 4 layouts and 7 critical includes are project-owned. Minima provides 4 layouts (`default`, `home`, `page`, `post`) and 10 includes (`head`, `header`, `footer`, `social`, `disqus_comments`, `google-analytics`, `icon-github`, `icon-twitter`, `icon-github.svg`, `icon-twitter.svg`). Only the first 3 includes are directly called by layouts; the rest are conditionally used.
- **jekyll-seo-tag is a hidden Minima dependency.** `minima-2.5.2.gemspec` declares `add_runtime_dependency("jekyll-seo-tag", "~> 2.1")`. Removing Minima removes this. Must add `jekyll-seo-tag` explicitly to `Gemfile` and `_config.yml` plugins list.
- **`{%- seo -%}` tag** generates: `<title>`, OG meta tags, canonical URL, structured data (JSON-LD), Twitter cards. Place before CSS `<link>` in `<head>`.
- **`{%- feed_meta -%}` tag** generates the Atom feed `<link>` tag. Works as long as `jekyll-feed` is in plugins (already is).
- **Asset pipeline unaffected** by removing theme. `assets/main.scss` compiles via `jekyll-sass-converter` using `sass: load_paths` from `_config.yml`, not from the theme. The CSS `<link>` tag is in our layout, not generated by Jekyll.
- **`header_pages` config:** Controls which pages appear in nav. Falls back to all `site.pages` if unset. Recommend keeping this pattern — it's a Jekyll convention.
- **Key Liquid variables to support:** `site.title`, `site.description`, `site.author`, `site.email`, `site.url`, `site.header_pages`, `site.show_excerpts`, `site.minima.date_format` (can rename), `page.title`, `page.date`, `page.tags`, `page.description`.

#### Bootstrap SME

- **Navbar SCSS imports needed:** `transitions` (collapse animation), `nav` (nav-link), `navbar` (navbar-collapse, navbar-toggler). Minimum 3 imports in order. `dropdown` is NOT required for a flat navbar — the `@include caret()` mixin lives in `_mixins.scss` (already loaded), and the `dropdown-menu` selector in `_navbar.scss` is only activated when `.dropdown-menu` elements exist in the markup. Verified by Bootstrap SME from source.
- **Navbar JS:** CSS-only collapse is not viable (no way to toggle `.show` class). Vendor `bootstrap.min.js` (no Popper) — ~29 kB minified, ~11 kB gzipped. Contains all Bootstrap plugins but Popper is excluded. Do NOT vendor `bootstrap.bundle.min.js` (77 kB, includes unnecessary Popper).
- **Additional components to enable:** `buttons` (nav, pagination styling), `badge` (post tags), `tables` (post content), `pagination` (prev/next). Defer: `card` (spec 007), `dropdown` (not needed for flat navbar).
- **Typography:** Recommend `$line-height-base: 1.65` (prose comfort), `$headings-font-weight: 600`, `$h1-font-size: 2rem` (right-sized for blog). RFS auto-scales headings down on mobile. **Note:** D5 chose `$headings-font-weight: 700` over this 600 recommendation — CSS SME agreed on 700 for stronger visual hierarchy in a blog context.
- **Container strategy:** Use `.container` outer (standard Bootstrap max-widths) with inner `max-width: 42rem` on prose content (~672px, ~75 characters/line optimal reading width). Don't use `.container-lg`.
- **Spacing:** Use Bootstrap spacer scale: `py-3` header, `py-5` main content, `py-4` footer, `mb-4` between post cards.
- **Color:** Recommended `#1a68d1` (4.93:1) — but A11y SME recommends stronger margin.

#### Accessibility SME

- **Skip link:** First focusable element in `<body>`, before `<header>`. Use `position: absolute; top: -100%` (hidden), `top: 0` on `:focus`. Target `<main id="main-content" tabindex="-1">`. Never use `display: none` or `visibility: hidden` (removes from a11y tree).
- **Landmarks:** `<header>` (banner), `<nav aria-label="Main navigation">`, `<main>`, `<article>`, `<footer>` (contentinfo). Multiple `<nav>` elements need distinct `aria-label` values.
- **Hamburger button:** Must have `aria-expanded`, `aria-controls`, `aria-label="Toggle navigation menu"`. Bootstrap collapse JS auto-updates `aria-expanded`. Icon gets `aria-hidden="true"`.
- **Menu hiding:** Bootstrap `.collapse` uses `display: none` — correct approach (removes from a11y tree AND tab order). Never use `aria-hidden` alone.
- **Escape key:** Bootstrap doesn't return focus to toggle on Escape. Need custom JS: listen for Escape, close collapse, focus toggle button.
- **Heading hierarchy:** Site title should be `<p>` (not `<h1>`) in header on all pages. Each page owns its own `<h1>`: post title, page title, or "Posts" on homepage.
- **`aria-current="page"`** on active nav link for screen readers. Combined with `.active` class for visual indication.
- **Post list links:** Use title as the link (self-descriptive). No separate "read more" links. Use `<time datetime="...">` for dates.
- **Footer social links:** Icon-only links need `aria-label`. Wrap in `<nav aria-label="Social media links">`. SVGs get `aria-hidden="true"`.
- **Color:** Recommend `#0060df` (5.74:1) — matches focus ring color `#005fcc` in feel. Target 5:1+ minimum.
- **`role="list"`** on `<ul>` inside navbar to restore list semantics stripped by Safari VoiceOver when `list-style: none` is applied.

#### CSS/Design SME

- **SCSS partials:** `_skip-link.scss`, `_header.scss`, `_nav.scss`, `_footer.scss`, `_post.scss`, `_post-card.scss`, `_page.scss`, `_sidebar.scss`. Import after `_base.scss` in `assets/main.scss`.
- **BEM naming:** `.site-header`, `.site-header__brand`, `.site-nav`, `.site-nav__link`, `.site-nav__link--active`, `.post-card`, `.post-card__title`, `.post`, `.post__title`, `.post__content`, `.site-footer`, `.page`, `.skip-link`, `.sidebar`.
- **BEM vs Bootstrap utilities:** BEM classes carry project styles in SCSS. Bootstrap utilities are additive in markup only (spacing, flex, display). Never target Bootstrap utility classes in project SCSS.
- **CSS custom properties to add:** Colors (primary, hover, text, muted, heading, bg, bg-alt, link, border, code-bg, nav-link, tag), Typography (font sizes, line heights), Spacing (xs through xxl), Layout (content-max-width, header-height, section-padding), Post meta (meta-color, meta-font-size, tag-bg/color/border).
- **Typography:** Post title `clamp(1.75rem, 4vw, 2.5rem)` fluid. Body at 1rem/1.65 line-height. Content headings: h2 1.5rem, h3 1.25rem, h4 1.125rem. Post meta 0.875rem in muted color. Tags 0.75rem with pill styling.
- **Content width:** `max-width: 42rem` (672px) on `.post__content` with `margin: auto`. Sidebar layout uses Bootstrap 8/4 grid on home page only.
- **Color palette:** Recommended `#1a5db5` (5.9:1). Text `#1a1a1a`, headings `#0f1923`, muted `#5c6470` (4.6:1), bg-alt `#f7f8f9`.
- **Responsive:** Navbar collapse at `md` (768px). Post title uses `clamp()` for fluid sizing. Content padding via Bootstrap responsive utilities (`py-4 py-md-5`).

#### Bootstrap Blog Template Analysis

The Bootstrap blog template (https://getbootstrap.com/docs/5.3/examples/blog/) uses:
- **Header:** Custom grid header (not navbar). Site title centered. Subscribe/search/signup buttons. Horizontal scroll sub-nav for categories.
- **Main content:** 8/4 grid — blog posts in `col-md-8`, sidebar in `col-md-4` with `position: sticky`.
- **Blog posts:** `.blog-post` class, `.blog-post-meta` for date/author (color #727272), 4rem bottom margin between posts.
- **Sidebar:** About section (`.bg-light .rounded`), Recent Posts, Archives (monthly links), Elsewhere (social links).
- **Footer:** Simple — credit line + back-to-top button.
- **Typography:** Playfair Display serif for headings and logo (external font — we substitute system stack).
- **Custom CSS:** Minimal (blog.css ~30 lines). Most styling via Bootstrap utility classes.

**What we adopt:**
- 8/4 grid layout with sidebar on homepage
- Blog post structure and spacing patterns
- Sidebar sections (About, Recent Posts, Archives, Social)
- Clean footer pattern

**What we adapt/skip:**
- Replace custom grid header with Bootstrap navbar (better mobile support)
- Skip horizontal scroll sub-nav (categories — spec 003)
- Skip featured post hero and cards (spec 007)
- Skip Playfair Display font (no external fonts)
- Skip subscribe/signup buttons (not applicable)

### Open Questions

All resolved during research.

#### QA SME Spec Review

22 findings: 4 errors, 11 warnings, 7 info. Resolutions:

- **E1 (Typography conflict):** Bootstrap SME recommended 600; D5 chose 700 per CSS SME. Notes updated with reconciliation note. D5 is authoritative.
- **E2 (Navbar dropdown dependency):** Bootstrap SME verified `dropdown` is NOT required for flat navbar. `_navbar.scss` only references `dropdown-menu` in selectors that apply when dropdown elements exist in markup. The `@include caret()` mixin is in `_mixins.scss` (already loaded). Updated notes and task 2.3.
- **E3 (Skip link placement):** Resolved: skip link goes in `default.html` before `{% include header.html %}`, not inside `header.html`. Updated spec requirement 1 and task 2.10. Task 2.7 no longer mentions skip link.
- **E4 (Bootstrap JS placement):** Resolved: load `bootstrap.min.js` with `defer` before `</body>` in `default.html`, not in `head.html`. Updated spec requirement 1, task 2.6, and task 2.10.
- **W5 (AC12 ambiguity):** Rewritten with specific hex value `#0060df` and ratio.
- **W6 (Muted color):** `#5c6470` at 4.6:1. Passes AA for normal text. Used only for supplementary text (dates, captions). Added to D4 notes.
- **W7 (Archives data source):** Pure Liquid using `site.posts` grouped by year/month. No plugin needed. Updated requirement 8.
- **W8 (show_excerpts):** Layout will always render `post.excerpt`. No `show_excerpts` config needed. Removed from affected files.
- **W9 (404.html inline styles):** Known issue — 404.html has inline `.container` styles that conflict with Bootstrap. Noted for testing. Full fix deferred to spec 014 (Custom 404).
- **W10 (Categories handling):** Existing post has `categories: jekyll update`. Layout will not display categories (tags only). Categories affect URL via Jekyll permalink. Noted for testing — verify URL is not broken.
- **W11 (role="list"):** Added to requirement 13 (semantic HTML).
- **W12 (Social links source):** Uses existing `_config.yml` fields: `github_username`, `twitter_username`. Updated requirement 8.
- **W13 (No AC for Escape key):** Added AC19.
- **W14 (Performance budget):** Deferred to spec 008 (SEO Foundation) for Lighthouse metrics. Page weight checked informally during testing.
- **W15 (minima: config block):** Added check to task 2.15. Current `_config.yml` is clean (no `minima:` block).
- **I16 (main.scss Minima comment):** Updated in task 2.3 scope.
- **I17 (about.markdown content):** Known placeholder — spec 006 territory.
- **I18 (assets/js/ directory):** Created implicitly with nav-keyboard.js. Standalone file is appropriate for this simple script.
- **I19 (html lang):** Added `{{ site.lang | default: "en" }}` to spec requirement 1 and AC20.
- **I20 (Heading hierarchy wording):** Clarified as content convention, not layout enforcement.
- **I21 (Task 1.8 notes):** Updated with summary.
- **I22 (Roadmap stale):** Will update roadmap.md.

### References

- Bootstrap blog template: https://getbootstrap.com/docs/5.3/examples/blog/
- Bootstrap blog template CSS: https://getbootstrap.com/docs/5.3/examples/blog/blog.css
- Minima 2.5 source: `C:/Ruby34-x64/lib/ruby/gems/3.4.0/gems/minima-2.5.2/`
- WCAG 2.2 contrast requirements: 4.5:1 minimum (AA), 7:1 (AAA)
- Optimal reading width: 45–75 characters per line (Bringhurst)

---

## Implementation

- **Bootstrap JS file size:** `bootstrap.min.js` (no Popper) is ~60KB on disk, not the ~29KB estimated during research. The 29KB figure was likely gzipped size. Still well within the 1MB page weight budget.
- **`_config.yml` had been modified** between research and implementation — the `url` field was updated to `https://aicodeblog.com`. No impact on implementation.
- **Task 1.9 (sign-off):** Marked as Done since the user initiated the implementation phase prompt.
- **Post URL with categories preserved:** The existing "Welcome to Jekyll!" post has `categories: jekyll update`, generating the URL `/jekyll/update/2026/02/22/welcome-to-jekyll.html`. This continues to work correctly with the new layouts.
- **404.html inline styles:** The 404 page has inline styles for `.container` (margin, max-width, text-align) and `h1` (margin, font-size, line-height). These don't conflict with Bootstrap's `.container` because the inline styles override utility class defaults. Noted as W9 in QA review — full fix deferred to spec 014.
- **Build output clean:** `bundle exec jekyll build` completes with no errors or warnings. All 4 page types (home, post, page, 404) render correctly with the new layouts.
- **10 commits on feature branch:** One per logical task as required by the commit strategy.

---

## Testing

### Acceptance Criteria Verification

| AC | Description | Result | Notes |
|----|-------------|--------|-------|
| AC1 | Layouts exist and render | **PASS** | All 4 layouts render on index, about, post, 404 |
| AC2 | Includes exist and render | **PASS** | head, header, footer, sidebar all present in output |
| AC3 | Minima removed | **PASS** | No `theme: minima` in _config.yml, no `gem "minima"` in Gemfile |
| AC4 | jekyll-seo-tag added | **PASS** | In both _config.yml plugins and Gemfile |
| AC5 | Header with title + nav | **PASS** | Site title links to `/`, About nav link present |
| AC6 | Responsive nav | **PASS** | `navbar-expand-md` handles collapse, hamburger present with aria attrs |
| AC7 | Footer content | **PASS** | Copyright 2026, description, GitHub + Twitter links |
| AC8 | Homepage 8/4 grid | **PASS** | `col-md-8` + `col-md-4` in index.html |
| AC9 | Sidebar sections | **PASS** | About, Recent Posts, Archives, Elsewhere all present |
| AC10 | Skip-to-content | **PASS** | `.skip-link` targets `#main-content` with `tabindex="-1"` |
| AC11 | Semantic landmarks | **PASS** | `<header>`, `<nav>`, `<main>`, `<article>`, `<footer>` on all pages |
| AC12 | Link color #0060df | **PASS** | `--color-link: #0060df` in compiled CSS, applied to `a` elements |
| AC13 | Typography / line-height 1.65 | **PASS** | `--bs-body-line-height: 1.65` in compiled CSS |
| AC14 | Post layout elements | **PASS** | Title, date, content present. Tags and prev/next conditional (correct — test post has no tags, only 1 post exists) |
| AC15 | Page layout centered | **PASS** | `max-width: var(--content-max-width)` (42rem) with `margin: auto` |
| AC16 | No horizontal overflow | **NEEDS BROWSER** | Cannot verify viewport behavior from static HTML. Bootstrap grid + container should prevent overflow. |
| AC17 | Build succeeds | **PASS** | `bundle exec jekyll build` — no errors, no warnings |
| AC18 | GitHub Actions deploy | **NEEDS PUSH** | Cannot verify until feature branch is merged and pushed to master |
| AC19 | Escape key closes menu | **NEEDS BROWSER** | JS code verified correct by A11y SME. Manual test needed. |
| AC20 | `<html lang="en">` | **PASS** | Present on all 4 generated pages |

**Result: 17 PASS, 3 deferred (AC16/AC18/AC19 need browser/deploy verification)**

### Accessibility SME Audit (Task 3.4)

15 checks performed. **All PASS** with 2 warnings:

- **A11y-W1: Duplicate nav aria-labels on homepage.** Sidebar and footer both use `aria-label="Social media links"`. Screen readers cannot distinguish them. **Fix:** Differentiate labels (e.g., "Social links" in sidebar, "Social media links" in footer).
- **A11y-W2: 404.html heading structure.** No `title` in front matter causes empty `<h1>` from page layout, plus content has its own `<h1>404</h1>` = duplicate h1. **Known issue — deferred to spec 014 (Custom 404).**

### QA SME Audit (Task 3.5)

0 errors, 5 warnings, 7 info items.

**Warnings (should fix):**
- **QA-W1: Duplicated tag pill styles.** `.post-card__tag` and `.post__tag` are identical. Extract shared styles.
- **QA-W2: Descendant `a` selector in `.post-card__title`.** Should use BEM class.
- **QA-W3: Descendant element selectors in `__content` blocks.** Accepted pattern for Markdown-generated content — document as deviation.
- **QA-W4: Missing Liquid comments on nested control flow blocks.** ~13 locations need comments per code guidelines.
- **QA-W5: Duplicate `aria-label="Social media links"`.** Same as A11y-W1.

**Info (nice to have):**
- QA-I1: Hardcoded `0.25rem` border-radius could be a token.
- QA-I2: Content-area element styles duplicated between post/page.
- QA-I3: Tag wrapper `<span class="ms-2">` has no BEM class.
- QA-I4: Tag `<span>` elements have `:hover` styles (dead code unless converted to links).
- QA-I5: Archive links point to individual posts, not archive pages.
- QA-I6: IIFE pattern instead of ES module (pragmatic choice for Bootstrap global access).
- QA-I7: Missing `@returns {void}` on JSDoc.

### Edge Cases Tested

- **Single post:** prev/next nav correctly omitted when only 1 post exists
- **Post with no tags:** tag section correctly omitted
- **Post with categories:** URL `/jekyll/update/...` preserved and links work
- **404.html inline styles:** Known W9 — `.container` inline styles override Bootstrap defaults without breaking layout
- **Empty `header_pages` config:** Fallback loop over `site.pages` works correctly

---

## Acceptance

- [Final review notes, user feedback, sign-off details]
